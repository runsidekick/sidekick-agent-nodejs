# Sidekick Agent NodeJS

Sidekick agent Nodejs is a Nodejs library that communicate with Sidekick broker to inspect, monitor and debug your application on the fly.

## Installation

```
npm install @runsidekick/sidekick-agent-nodejs
```

There are two way to integrate Sidekick agent to your application.

### Integrate Agent with Environment Variable

You can easily integrate Sidekick using below environment variables.

* set ``SIDEKICK_APIKEY`` environment variable with your Sidekick api key. 
* set ``NODE_OPTIONS`` environment variable with `` '-r @runsidekick/sidekick-agent-nodejs/dist/bootstrap' ``

### Integrate Agent with Code

You can easily integrate Sidekick adding below code block to top of your project.

JS example
``` js
const SidekickDebugger = require('@runsidekick/sidekick-agent-nodejs');

SidekickDebugger.start({ 
    apiKey: '<Your_Api_Key>'
});

...
```

TS example
``` ts
import * as SidekickDebugger from '@runsidekick/sidekick-agent-nodejs';

SidekickDebugger.start({ 
    apiKey: '<Your_Api_Key>'
});

...

```

## Configs

| Config                                        | Requirement       | Environment Variable                          | Default
| ---                                           | ---               | ---                                           | ---
| apiKey <string>                               | Required          | SIDEKICK_APIKEY                               | None
| logLevel <string>                             | Optional          | SIDEKICK_AGENT_LOG_LEVEL                      | info
| disable <boolean>                             | Optional          | SIDEKICK_AGENT_DISABLE                        | false
| brokerHost <string>                           | Optional          | SIDEKICK_AGENT_BROKER_HOST                    | Sidekick broker address
| brokerPort <string>                           | Optional          | SIDEKICK_AGENT_BROKER_PORT                    | Sidekick broker port
| brokerClient <string>                         | Optional          | SIDEKICK_AGENT_BROKER_CLIENT                  | Logged in user
| applicationId <string>                        | Optional          | SIDEKICK_AGENT_APPLICATION_ID                 | Generated by agent
| applicationName <string>                      | Optional          | SIDEKICK_AGENT_APPLICATION_NAME               | Empty string
| applicationInstanceId <string>                | Optional          | SIDEKICK_AGENT_APPLICATION_INSTANCE_ID        | Generated by agent
| applicationVersion <string>                   | Optional          | SIDEKICK_AGENT_APPLICATION_VERSION            | Empty string
| applicationStage <string>                     | Optional          | SIDEKICK_AGENT_APPLICATION_STAGE              | Empty string
| applicationTag <map>                          | Optional          | SIDEKICK_AGENT_APPLICATION_TAG                | None
| maxFrames <number>                            | Optional          | SIDEKICK_AGENT_MAX_FRAMES                     | 20
| maxExpandFrames <number>                      | Optional          | SIDEKICK_AGENT_MAX_EXPAND_FRAMES              | 1
| maxProperties <number>                        | Optional          | SIDEKICK_AGENT_MAX_PROPERTIES                 | 10
| maxParseDepth <number>                        | Optional          | SIDEKICK_AGENT_MAX_PARSE_DEPTH                | 3
| propertyAccessClassification <string>         | Optional          | SIDEKICK_AGENT_PROPERTY_ACCESS_CLASSIFICATION | ENUMERABLE-OWN
| scriptPrefix <string>                         | Optional          | SIDEKICK_AGENT_SCRIPT_PREFIX                  | None
| rejectOnStartup <boolean>                     | Optional          | SIDEKICK_AGENT_REJECT_ON_STARTUP              | false
| captureFrameDataReductionCallback <function>  | Optional          |                                               | None
| logMessageDataReductionCallback <function>    | Optional          |                                               | None
| errorCollectionEnable <boolean>               | Optional          | SIDEKICK_AGENT_ERROR_COLLECTION_ENABLE        | false
| errorCollectionEnableCaptureFrame <boolean>   | Optional          | SIDEKICK_AGENT_ERROR_COLLECTION_CAPTURE_FRAME | false

### Valid Config Values

- `propertyAccessClassification` (`SIDEKICK_AGENT_PROPERTY_ACCESS_CLASSIFICATION`) configuration can take one of following values:
  - `ENUMERABLE-OWN` (default value)
  - `ENUMERABLE-OWN-AND-ENUMERABLE-PARENT`
  - `ENUMERABLE-OWN-AND-NON-ENUMERABLE-OWN`
  - `ENUMERABLE-OWN-AND-NON-ENUMERABLE-OWN-ENUMERABLE-PARENT`
